<!doctype html>
<html lang="es" data-theme="black">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="GlobalEye Trends — Memes tipo Reddit + tendencias + timeline de X." />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <meta property="og:title" content="GlobalEye — Memes & Trends" />
  <meta property="og:description" content="Memes · Tendencias · X feed" />
  <meta property="og:image" content="./banner_ojo.jpg" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./logo_ojo_favicon.png" />
  <link rel="apple-touch-icon" href="./logo_ojo_favicon.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400,0,0&display=swap" rel="stylesheet" />

  <link rel="preload" as="image" href="./banner_ojo.jpg" />
  <link rel="preload" as="image" href="./logo_ojo_png.png" />
  <link rel="preload" as="image" href="./logo_ojo_gif.gif" />

  <link rel="stylesheet" href="./styles.css" />
  <script defer src="./app.js"></script>

  <title>GlobalEye — Memes & Trends</title>
</head>

<body>
  <a class="skipLink" href="#main">Saltar al contenido</a>

  <div id="bootSplash" class="bootSplash" role="status" aria-label="Cargando" aria-live="polite">
    <div class="bootInner">
      <img class="bootLogo" src="./logo_ojo_gif.gif" alt="GlobalEye" decoding="async" fetchpriority="high" />
      <div class="bootDots" aria-hidden="true">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
      <div class="bootHint">Cargando…</div>
    </div>
  </div>

  <header class="topbar" role="banner" aria-label="GlobalEye">
    <div class="topbarBanner" aria-hidden="true">
      <img class="topbarBannerImg" src="./banner_ojo.jpg" alt="" decoding="async" fetchpriority="high" />
      <div class="topbarBannerShade"></div>
    </div>

    <div class="topbarInner">
      <div class="brand" role="presentation">
        <img class="brandLogo" src="./logo_ojo_png.png" alt="GlobalEye" decoding="async" />
        <div class="brandText">
          <div class="brandTitle">GLOBAL EYE</div>
          <div class="brandSub">Memes · Tendencias · X feed</div>
        </div>
      </div>

      <nav class="tabs" aria-label="Vistas">
        <button id="tabMemes" class="tab isActive" type="button">
          <span class="msr">collections</span><span class="lbl">Memes</span>
        </button>
        <button id="tabTrends" class="tab" type="button">
          <span class="msr">trending_up</span><span class="lbl">Tendencias</span>
        </button>
        <button id="tabFavs" class="tab" type="button">
          <span class="msr">star</span><span class="lbl">Favoritos</span>
        </button>
      </nav>

      <div class="topActions" aria-label="Acciones">
        <a class="btn ghost" href="https://x.com/GlobalEye_TV" target="_blank" rel="noreferrer">
          <span class="msr">open_in_new</span><span class="lbl">@GlobalEye_TV</span>
        </a>

        <button id="btnReloadX" class="btn ghost" type="button" title="Recargar feed de X">
          <span class="msr">refresh</span><span class="lbl">Feed</span>
        </button>

        <button id="btnRefresh" class="btn" type="button" title="Actualizar datos">
          <span class="msr">sync</span><span class="lbl">Actualizar</span>
        </button>

        <button id="btnCompact" class="btn ghost" type="button" title="Modo compacto">
          <span class="msr">density_small</span><span class="lbl">Compacto</span>
        </button>

        <button id="btnTicker" class="btn ghost" type="button" title="Ticker inferior (OBS)">
          <span class="msr">view_headline</span><span class="lbl">Ticker</span>
        </button>

        <button id="btnConfig" class="btn ghost" type="button" title="Configuración">
          <span class="msr">settings</span><span class="lbl">Config</span>
        </button>

        <div class="topStatus" role="status" aria-label="Estado">
          <span class="pill" title="Estado de red">
            <span class="msr">public</span><span id="netStatus">Online</span>
          </span>
          <span class="pill" title="Última actualización">
            <span class="msr">schedule</span><span id="lastUpdated">—</span>
          </span>
        </div>
      </div>
    </div>
  </header>

  <main id="main" class="layout" role="main">
    <section class="mainCol">
      <div class="panelHead">
        <div class="searchWrap">
          <span class="msr">search</span>
          <input id="q" class="search" type="search" placeholder="Buscar…" autocomplete="off" />
        </div>

        <div class="filters" aria-label="Filtros">
          <select id="selSource" class="select" title="Fuente memes">
            <option value="OJOOJITOOJETE" selected>r/OJOOJITOOJETE</option>
            <option value="mix">Mix (ES+EN)</option>
            <option value="memesESP">r/memesESP</option>
            <option value="memesenespanol">r/memesenespanol</option>
            <option value="memes">r/memes</option>
            <option value="dankmemes">r/dankmemes</option>
            <option value="me_irl">r/me_irl</option>
            <option value="wholesomememes">r/wholesomememes</option>
            <option value="funny">r/funny</option>
            <option value="custom">Custom…</option>
          </select>

          <input id="subCustom" class="input inputSub hidden" type="text" placeholder="subreddit (sin r/)" spellcheck="false" />

          <select id="selSort" class="select" title="Orden">
            <option value="new" selected>New</option>
            <option value="hot">Hot</option>
            <option value="top">Top</option>
            <option value="best">Best (tus votos)</option>
          </select>

          <select id="selRange" class="select" title="Rango">
            <option value="24">24h</option>
            <option value="48" selected>48h</option>
            <option value="72">72h</option>
          </select>
        </div>
      </div>

      <div id="errBanner" class="banner err hidden" role="alert"></div>
      <div id="emptyBanner" class="banner empty hidden" role="status">No hay resultados con estos filtros.</div>

      <section id="viewMemes" class="view">
        <div id="memesList" class="list" aria-live="polite"></div>
      </section>

      <section id="viewTrends" class="view hidden">
        <div class="sectionTitle">
          <span class="msr">trending_up</span>
          <span>Tendencias / Hashtags (open data)</span>
          <span class="muted">· +info dentro de cada tarjeta</span>
        </div>
        <div id="trendsList" class="list trends" aria-live="polite"></div>
      </section>

      <section id="viewFavs" class="view hidden">
        <div class="sectionTitle">
          <span class="msr">star</span>
          <span>Favoritos</span>
        </div>
        <div id="favsList" class="list" aria-live="polite"></div>
      </section>
    </section>

    <aside class="sideCol">
      <div class="card">
        <div class="cardTitle">
          <span class="msr">for_you</span><span>Feed de X</span>
        </div>

        <div id="xTimelineMount" class="xMount"></div>

        <div id="xFallback" class="xFallback hidden">
          <div class="xFallbackText">
            El widget puede estar bloqueado por privacidad/adblock. La app intentará mostrar un feed alternativo cuando sea posible.
          </div>
          <div class="xFallbackActions">
            <a class="btn" href="https://x.com/GlobalEye_TV" target="_blank" rel="noreferrer">
              <span class="msr">open_in_new</span><span class="lbl">Abrir perfil</span>
            </a>
            <button id="btnXRetry" class="btn ghost" type="button">
              <span class="msr">refresh</span><span class="lbl">Reintentar</span>
            </button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardTitle">
          <span class="msr">info</span><span>Notas</span>
        </div>
        <div class="hint">
          Memes: solo posts con imagen/vídeo (sin NSFW).<br />
          Tendencias: calculadas desde titulares (GDELT) + ejemplos.<br />
          Votos/Favs: se guardan localmente (tu navegador).<br />
          Descarga: (cuando esté activa) desde cada tarjeta.<br />
          X: widget oficial + fallback cuando esté bloqueado.
        </div>
      </div>

      <noscript>
        <div class="card">
          <div class="cardTitle"><span class="msr">warning</span><span>JavaScript desactivado</span></div>
          <div class="hint">Activa JavaScript para ver memes, tendencias y el feed de X.</div>
        </div>
      </noscript>
    </aside>
  </main>

  <div id="tickerBar" class="ticker hidden" aria-label="Ticker">
    <div class="tickerInner">
      <span class="msr">view_headline</span>
      <div id="tickerTrack" class="tickerTrack"></div>
      <button id="tickerClose" class="iconBtn" type="button" title="Cerrar ticker" aria-label="Cerrar ticker">
        <span class="msr">close</span>
      </button>
    </div>
  </div>

  <div id="cfgModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Configuración">
    <div class="modalCard">
      <div class="modalHead">
        <div class="modalTitle">
          <span class="msr">settings</span><span>Configuración</span>
        </div>
        <button id="cfgClose" class="iconBtn" type="button" aria-label="Cerrar">
          <span class="msr">close</span>
        </button>
      </div>

      <div class="modalBody">
        <label class="row">
          <span>Auto-refresh</span>
          <input id="cfgAuto" type="checkbox" checked />
        </label>

        <label class="row">
          <span>Actualizar cada (seg)</span>
          <input id="cfgEvery" class="input" type="number" min="35" max="900" value="120" />
        </label>

        <label class="row">
          <span>Máx memes</span>
          <input id="cfgMaxPosts" class="input" type="number" min="10" max="120" value="45" />
        </label>

        <label class="row">
          <span>Ocultar media (solo títulos)</span>
          <input id="cfgNoThumbs" type="checkbox" />
        </label>

        <label class="row">
          <span>Velocidad ticker</span>
          <input id="cfgTickerSpeed" class="input" type="number" min="30" max="300" value="120" />
        </label>
      </div>

      <div class="modalFoot">
        <button id="cfgSave" class="btn" type="button">
          <span class="msr">check</span><span class="lbl">Guardar</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const sel = document.getElementById("selSource");
      const input = document.getElementById("subCustom");
      const KEY = "ge_custom_sub_v1";
      const optId = "optCustomDyn";

      const btnRetry = document.getElementById("btnXRetry");
      const btnReloadX = document.getElementById("btnReloadX");
      if (btnRetry && btnReloadX) btnRetry.addEventListener("click", () => btnReloadX.click());

      function normSub(v){
        return String(v || "").trim().replace(/^r\//i, "").replace(/\s+/g, "");
      }

      function ensureOpt(value){
        const v = normSub(value);
        if (!v) return null;
        let opt = document.getElementById(optId);
        if (!opt){
          opt = document.createElement("option");
          opt.id = optId;
          sel.appendChild(opt);
        }
        opt.value = v;
        opt.textContent = `r/${v} (custom)`;
        return opt;
      }

      function showInput(on){
        if (!input) return;
        input.classList.toggle("hidden", !on);
        if (on) setTimeout(() => input.focus(), 0);
      }

      function applySaved(){
        try{
          const saved = localStorage.getItem(KEY);
          if (saved) ensureOpt(saved);
        }catch{}
      }

      function commitCustom(){
        const v = normSub(input.value);
        if (!v) return;
        ensureOpt(v);
        try{ localStorage.setItem(KEY, v); }catch{}
        sel.value = v;
        showInput(false);
        sel.dispatchEvent(new Event("change", { bubbles: true }));
      }

      applySaved();

      if (sel && input){
        sel.addEventListener("change", () => {
          if (sel.value === "custom"){
            showInput(true);
            try{
              const saved = localStorage.getItem(KEY) || "";
              input.value = saved;
            }catch{}
          }else{
            showInput(false);
          }
        });

        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter"){
            e.preventDefault();
            commitCustom();
          }
        });
        input.addEventListener("blur", () => {
          if (!input.classList.contains("hidden")) commitCustom();
        });
      }
    })();
  </script>
</body>
</html>
